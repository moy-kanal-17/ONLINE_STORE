<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MY17Shop - Zamonaviy Online Do'kon</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="icon" href="/public/favicon.ico" type="image/x-icon">
    <style>
        :root {
            --primary: #030303;
            --secondary: #00b4d8;
            --accent: #ffd700;
            --dark: #1a1a1a;
            --light: #fff;
            --gradient-bg: linear-gradient(135deg, #000000, #000000);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--gradient-bg);
            color: var(--dark);
            overflow-x: hidden;
        }

        /* Header */
        header {
            background: var(--light);
            padding: 1.5rem 3rem;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }

        .logo a {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: color 0.3s, transform 0.3s;
        }

        .logo a:hover {
            color: var(--secondary);
            transform: scale(1.05);
        }

        .search-bar {
            flex: 1;
            max-width: 600px;
            margin: 0 2rem;
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: 1rem 3rem;
            border: 2px solid var(--primary);
            border-radius: 50px;
            font-size: 1.1rem;
            background: rgba(255,255,255,0.9);
            transition: border-color 0.3s, box-shadow 0.3s, transform 0.3s;
        }

        .search-bar input:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 15px rgba(0,180,255,0.3);
            transform: scale(1.02);
            outline: none;
        }

        .search-bar i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            font-size: 1.2rem;
        }

        .account-btn, .category-btn {
            padding: 1rem 2rem;
            background: var(--primary);
            color: var(--light);
            border: none;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background 0.4s, transform 0.3s, box-shadow 0.3s;
        }

        .account-btn:hover, .category-btn:hover {
            background: var(--secondary);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,180,255,0.4);
        }

        /* Hero Banner */
        .hero-banner {
            background: var(--gradient-bg);
            color: var(--light);
            padding: 2rem;
            text-align: center;
            margin: 1rem auto;
            max-width: 1280px;
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            animation: fadeIn 1s ease-out;
        }

        .hero-banner h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .hero-banner p {
            font-size: 1.2rem;
            font-weight: 600;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Pop-up Banners */
        .popup-banner {
            position: fixed;
            top: 20px;
            right: -100%;
            max-width: 350px;
            background: var(--light);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            z-index: 2000;
            display: none;
            animation: slideInRight 0.5s ease-out forwards;
        }

        .popup-banner.active {
            display: block;
            right: 20px;
        }

        @keyframes slideInRight {
            from { right: -100%; }
            to { right: 20px; }
        }

        .popup-banner h3 {
            font-size: 1.3rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .popup-banner p {
            font-size: 1rem;
            color: var(--dark);
            margin-bottom: 1rem;
        }

        .popup-banner a {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            background: var(--primary);
            color: var(--light);
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: background 0.3s, transform 0.3s;
        }

        .popup-banner a:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .popup-close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2rem;
            color: var(--dark);
            cursor: pointer;
            transition: color 0.3s;
        }

        .popup-close:hover {
            color: var(--primary);
        }

        /* Categories */
        .categories {
            display: flex;
            gap: 1rem;
            padding: 1.5rem 2rem;
            max-width: 1280px;
            margin: 0 auto;
            overflow-x: auto;
        }

        .category-item {
            padding: 1rem 2rem;
            background: var(--light);
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            transition: background 0.3s, color 0.3s, transform 0.3s;
            white-space: nowrap;
        }

        .category-item:hover, .category-item.active {
            background: var(--primary);
            color: var(--light);
            transform: scale(1.1);
        }

        /* Food Grid */
        .food-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            padding: 2rem;
            max-width: 1280px;
            margin: 0 auto;
        }

        .food-card-link {
            text-decoration: none;
            color: inherit;
            transition: transform 0.3s;
        }

        .food-card-link:hover {
            transform: scale(1.05);
        }

        .food-card {
            background: var(--light);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 6px 30px rgba(0,0,0,0.15);
            transition: box-shadow 0.3s, transform 0.3s;
        }

        .food-card:hover {
            box-shadow: 0 12px 40px rgba(0,0,0,0.2);
            transform: translateY(-5px);
        }

        .food-image {
            width: 100%;
            height: 220px;
            object-fit: cover;
        }

        .card-body {
            padding: 1.5rem;
        }

        .food-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
        }

        .details {
            display: flex;
            justify-content: space-between;
            font-size: 1rem;
            color: #666;
            margin-bottom: 0.8rem;
        }

        .price {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--accent);
        }

        .discount {
            color: #e0d6d7;
            font-weight: bold;
        }


        footer {
            background: var(--dark);
            color: var(--light);
            padding: 3rem 2rem;
            text-align: center;
        }

        .footer-links a {
            color: var(--light);
            margin: 0 1.5rem;
            font-size: 1.1rem;
            text-decoration: none;
            transition: color 0.3s, transform 0.3s;
        }

        .footer-links a:hover {
            color: var(--primary);
            transform: translateY(-2px);
        }

        .social-icons a {
            font-size: 2rem;
            margin: 0 1rem;
            color: var(--light);
            transition: color 0.3s, transform 0.3s;
        }

        .social-icons a:hover {
            color: var(--secondary);
            transform: scale(1.2);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background: var(--light);
            padding: 3rem;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
            animation: popIn 0.4s ease-out;
        }

        @keyframes popIn {
            from { transform: scale(0.7); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            font-size: 2rem;
            cursor: pointer;
            color: var(--dark);
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: var(--primary);
        }

        #modalTitle {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
        }

        #foodDetailsDiv p, #accountDetails p {
            font-size: 1.2rem;
            margin: 0.8rem 0;
            color: var(--dark);
        }

        /* Loader */
        .loader {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .loader::after {
            content: '';
            width: 50px;
            height: 50px;
            border: 6px solid var(--primary);
            border-top: 6px solid transparent;
            border-radius: 50%;
            display: inline-block;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 1.5rem;
                padding: 1rem;
            }
            .search-bar {
                margin: 0;
                max-width: 100%;
            }
            .hero-banner h1 {
                font-size: 2rem;
            }
            .hero-banner p {
                font-size: 1rem;
            }
            .food-grid {
                grid-template-columns: 1fr;
            }
            .popup-banner {
                max-width: 90%;
                top: 10px;
                right: 10px !important;
            }
        }
    </style>
</head>
<body>

    <header>
        <div class="logo"><a href="/foods/main">MYShop</a></div>
        <div class="search-bar">
            <i class="fas fa-search"></i>
            <input id="searchInput" type="text" placeholder="Mahsulot qidirish...">
        </div>
        <div>
            <button class="category-btn" id="filterBtn"><i class="fas fa-filter"></i> Kategoriyalar</button>
            <a href="/foods/account"><button class="account-btn" id="accountBtn"><i class="fas fa-user"></i> Akkaunt</button></a>
        </div>
    </header>


    <div class="hero-banner">
        <h1>Zamonaviy MY17Shop - Sizning onlayn do'koningiz!</h1>
        <p>Eng sifatli mahsulotlar va tez yetkazib berish!</p>
    </div>


    <div class="popup-banner" id="popup1">
        <span class="popup-close" onclick="closePopup('popup1')">×</span>
        <h3>Vam interesen @MOY17Bot??</h3>
        <p>Zabiray skidki v nashem Telegram-bote!</p>
        <a href="https://t.me/MOY_17_BOT">Prisoedinyaysya!</a>
    </div>
    <div class="popup-banner" id="popup2">
        <span class="popup-close" onclick="closePopup('popup2')">×</span>
        <h3>50% gacha chegirmalar!</h3>
        <p>Tezda xarid qiling, aksiyalar cheklangan!</p>
        <a href="/main">Hozir xarid qilish!</a>
    </div>
    <div class="popup-banner" id="popup3">
        <span class="popup-close" onclick="closePopup('popup3')">×</span>
        <h3>Bizning Telegram kanallarimiz!</h3>
        <p>Yangiliklar va takliflar: @uzgame_pc va @varenoma</p>
        <a href="https://t.me/uzgame_pc">Obuna bo'lish!</a>
    </div>


    <div class="categories">
        <div class="category-item" data-category="all">Hammasi</div>
        <div class="category-item" data-category="electronics">Elektronika</div>
        <div class="category-item" data-category="fashion">Moda</div>
        <div class="category-item" data-category="home">Uy-ro'zg'or</div>
        <div class="category-item" data-category="foods">Taomlar</div>
    </div>


    <div id="foodGrid" class="food-grid">
        {{#each foods}}
        <a href="/foods/product/{{this.id}}" class="food-card-link">
            <div class="food-card" data-name="{{this.name}}" data-author="{{this.author}}" data-price="{{this.price}}" data-rating="{{this.rating}}" data-time="{{this.id}}" data-skids="{{this.skids}}" data-category="{{this.category}}">
                <img src="/images/{{this.image}}" alt="{{this.name}}" class="food-image">
                <div class="card-body">
                    {{!-- <div><h1>data-category</h1></div> --}}
                    <div class="food-name">{{this.name}}</div>
                    <div class="details">
                        <div><i class="fas fa-star"></i> {{this.rating}}</div>
                        <div><i class="fas fa-clock"></i> {{this.id}} min</div>
                    </div>
                    <div>
                        <span class="price">{{this.price}} so'm</span>
                        {{#if this.skids}}<span class="discount">-{{this.skids}}%</span>{{/if}}
                    </div>
                </div>
            </div>
        </a>
        {{/each}}
    </div>


    <div class="loader" id="loader"></div>


    <footer>
        <div class="footer-links">
            <a href="/about">Biz haqimizda</a>
            <a href="/contact">Kontaktlar</a>
            <a href="/policy">Maxfiylik siyosati</a>
        </div>
        <div class="social-icons">
            <a href="https://t.me/uzgame_pc"><i class="fab fa-telegram"></i></a>
            <a href="https://t.me/varenoma"><i class="fab fa-telegram"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-facebook"></i></a>
        </div>
        <p>© 2025 MY17Shop. Barcha huquqlar himoyalangan.</p>
    </footer>


    <div id="modal" class="modal">
        <div class="modal-content">
            <span id="modalClose" class="modal-close">×</span>
            <h2 id="modalTitle">Tafsilotlar</h2>
            <div id="foodDetailsDiv">
                <h2 id="modalName"></h2>
                <p id="modalAuthor"></p>
                <p><strong>Narxi:</strong> <span id="modalPrice"></span> so'm</p>
                <p><strong>Reyting:</strong> <span id="modalRating"></span> <i class="fas fa-star"></i></p>
                <p><strong>Yetkazib berish vaqti:</strong> <span id="modalTime"></span> min</p>
                <p id="modalDiscount" style="color: #dc3545; font-weight: 700;"></p>
            </div>
            <div id="accountDetails" style="display: none;">
                <h2>Akkaunt ma'lumotlari</h2>
                <p><strong>Email:</strong> <span id="accountEmail"></span></p>
                <p><strong>Rol:</strong> <span id="accountRole"></span></p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
    <script>

        const popups = [
            { id: 'popup1', delay: 5000 },
            { id: 'popup2', delay: 20000 },
            { id: 'popup3', delay: 35000 }
        ];

        function showPopup(id) {
            const popup = document.getElementById(id);
            popup.classList.add('active');
            setTimeout(() => {
                popup.classList.remove('active');
            }, 10000); 
        }

        function closePopup(id) {
            document.getElementById(id).classList.remove('active');
        }

        popups.forEach(popup => {
            setTimeout(() => {
                showPopup(popup.id);
                setInterval(() => showPopup(popup.id), 120000); 
            }, popup.delay);
        });


        const searchInput = document.getElementById('searchInput');
        const foodGrid = document.getElementById('foodGrid');
        const modal = document.getElementById('modal');
        const modalClose = document.getElementById('modalClose');
        const accountBtn = document.getElementById('accountBtn');
        const filterBtn = document.getElementById('filterBtn');
        const foodDetailsDiv = document.getElementById('foodDetailsDiv');
        const accountDetailsDiv = document.getElementById('accountDetails');
        const modalTitle = document.getElementById('modalTitle');
        const loader = document.getElementById('loader');

        searchInput.addEventListener('input', () => {
            const filter = searchInput.value.toLowerCase();
            const cards = foodGrid.querySelectorAll('.food-card-link');
            cards.forEach(link => {
                const card = link.querySelector('.food-card');
                const name = card.getAttribute('data-name').toLowerCase();
                link.style.display = name.includes(filter) ? 'block' : 'none';
            });
        });


        document.querySelectorAll('.category-item').forEach(item => {
            item.addEventListener('click', () => {
                const category = item.getAttribute('data-category');
                const cards = foodGrid.querySelectorAll('.food-card-link');
                cards.forEach(link => {
                    const card = link.querySelector('.food-card');
                    const cardCategory = card.getAttribute('data-category');
                    link.style.display = (category === 'all' || cardCategory === category) ? 'block' : 'none';
                });
                document.querySelectorAll('.category-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
            });
        });


        foodGrid.addEventListener('click', (e) => {
            const cardLink = e.target.closest('.food-card-link');
            if (cardLink) return;

            const card = e.target.closest('.food-card');
            if (!card) return;

            modalTitle.textContent = 'Tafsilotlar';
            foodDetailsDiv.style.display = 'block';
            accountDetailsDiv.style.display = 'none';

            document.getElementById('modalName').textContent = card.getAttribute('data-name');
            document.getElementById('modalAuthor').textContent = 'Muallif: ' + card.getAttribute('data-author');
            document.getElementById('modalPrice').textContent = card.getAttribute('data-price');
            document.getElementById('modalRating').textContent = card.getAttribute('data-rating');
            document.getElementById('modalTime').textContent = card.getAttribute('data-time');

            const discount = card.getAttribute('data-skids');
            const discountElem = document.getElementById('modalDiscount');
            if (discount && discount !== 'undefined') {
                discountElem.textContent = `Chegirma: -${discount}%`;
                discountElem.style.display = 'block';
            } else {
                discountElem.style.display = 'none';
            }

            modal.style.display = 'flex';
        });


        function getCookie(name) {
            const cookies = document.cookie.split('; ');
            for (let cookie of cookies) {
                const [key, value] = cookie.split('=');
                if (key === name) return value;
            }
            return null;
        }


        accountBtn.addEventListener('click', () => {
            const accessToken = getCookie('access_token');
            if (accessToken) {
                try {
                    const payload = jwt_decode(accessToken);
                    const email = payload.email || 'Noma\'lum';
                    const role = payload.role || 'Noma\'lum';

                    modalTitle.textContent = 'Akkaunt ma\'lumotlari';
                    foodDetailsDiv.style.display = 'none';
                    accountDetailsDiv.style.display = 'block';
                    document.getElementById('accountEmail').textContent = email;
                    document.getElementById('accountRole').textContent = role;
                    modal.style.display = 'flex';
                } catch (error) {
                    console.error('Tokenni parchalashda xatolik:', error);
                    alert('Akkaunt ma\'lumotlarini olishda xatolik yuz berdi.');
                }
            } else {
                alert('Siz tizimga kirmagansiz yoki token topilmadi.');
            }
        });


        modalClose.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        window.addEventListener('click', (e) => {
            if (e.target === modal) modal.style.display = 'none';
        });


        window.addEventListener('load', () => {
            loader.style.display = 'block';
            setTimeout(() => {
                loader.style.display = 'none';
                foodGrid.style.display = 'grid';
            }, 1000);
        });
    </script>
</body>
</html>